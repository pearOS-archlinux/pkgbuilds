# Maintainer : Alexandru Balan <alex@pear-software.com>

pkgname=plasma-welcome
_realname=plasma-welcome
pkgdesc="pearOS NiceC0re Welcome application"
pkgver=25.12.10
pkgrel=1
arch=('x86_64')
depends=('python' 'pyside6')
# makedepends=('python-pip' 'python-pyinstaller')
url="https://pear-software.com"
license=('MIT')

prepare() {
  # Copy contents of current directory to build directory
  mkdir -p ${srcdir}/${_realname}
  rsync -a --exclude='src' --exclude='pkg' --exclude='*.pkg.tar.*' --exclude='.git' --exclude='build' ${startdir}/ ${srcdir}/${_realname}/
  
  # Copy the already-built executable from dist/
  mkdir -p ${srcdir}/${_realname}/dist
  cp ${startdir}/dist/pearos-welcome ${srcdir}/${_realname}/dist/pearos-welcome
}

build() {
  # No build needed - executable is already built by 'make build'
  # Just verify it exists
  if [ ! -f "${startdir}/dist/pearos-welcome" ]; then
    echo "ERROR: Executable not found. Run 'make build' first."
    exit 1
  fi
}

package() {
  cd ${srcdir}/${_realname}

  # Install executable from dist/
  install -Dm755 ${srcdir}/${_realname}/dist/pearos-welcome \
    ${pkgdir}/usr/bin/pearos-welcome
  
  # Install desktop file
  install -Dm644 ${srcdir}/${_realname}/assets/welcome.desktop \
    ${pkgdir}/usr/share/applications/welcome.desktop
  
  # Install icon
  install -Dm644 ${srcdir}/${_realname}/assets/welcome.png \
    ${pkgdir}/usr/share/pixmaps/welcome.png
}
